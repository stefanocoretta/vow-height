---
title: "vow-height"
---

```{r}
#| message: false

library(tidyverse)
theme_set(theme_light())
library(magrittr)
library(coretta2018itaegg)
library(brms)
```

```{r}
data("formants")

formants %<>% mutate(
  label = as.factor(label),
  duration_c = as.vector(scale(duration)),
  duration_log = as.vector(scale(log(duration))),
  f13_c = as.vector(scale(f13))
)
contrasts(formants$label) <- "contr.sum"
```

```{r}
formants %>%
  ggplot(aes(f13_c, duration_c, colour = label)) +
  geom_point(alpha = 0.25) +
  geom_smooth(method = "lm")
```

```{r}
priors <- c(
  prior(normal(0, 1), class = Intercept),
  prior(normal(0, 1), class = b),
  prior(cauchy(0, 0.5), class = sigma),
  prior(lkj(2), class = cor),
  prior(cauchy(0, 0.5), class = sd)
)

bm_1_priors <- brm(
  duration_log ~
    vowel * f13_c +
    (vowel * f13_c | speaker),
  family = gaussian,
  data = formants,
  prior = priors,
  cores = 4,
  threads = threading(2),
  backend = "cmdstanr",
  sample_prior = "only",
  file = "data/cache/bm_1_priors",
)
```

```{r}
conditional_effects(bm_1_priors, "f13_c:vowel")
```

```{r}
bm_1 <- brm(
  duration_log ~
    vowel * f13_c +
    (vowel * f13_c | speaker),
  family = gaussian,
  data = formants,
  prior = priors,
  cores = 4,
  threads = threading(2),
  backend = "cmdstanr",
  file = "data/cache/bm_1",
)
```

```{r}
bm_1
```

```{r}
conditional_effects(bm_1, "f13_c:vowel")
conditional_effects(bm_1, "f13_c:vowel", spaghetti = TRUE, ndraws = 100)
```

